/*
 * WebSearch - v1.1.1 minified
 * (jQuery UI independent version)
 *
 * Copyright 2010, Rob Garrison (aka Mottie/Fudgey)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 */

 (function(d){d.websearch=function(f,h){var a=this;a.$el=d(f);a.el=f;a.$el.data("websearch",a);a.init=function(){a.options=d.extend({},d.websearch.defaultOptions,h);a._create()};a._create=function(){a.$el.addClass("websearch-input").wrap('<div class="websearch"/>').after('<button class="websearch-search '+a.options.tooltipClass+'"><span class="icon-websearch icon-websearch-search"></span></button><button class="websearch-select '+a.options.tooltipClass+'"><span class="icon-websearch icon-websearch-select"></span></button><div class="websearch-popup"></div>').bind("mouseup focusout", function(){a._popup(false)});a.$wrap=a.$el.closest(".websearch");a.$popup=a.$wrap.find(".websearch-popup").hide();a.$button=a.$wrap.find("button");a.$button.bind("click",function(){if(d(this).is(".websearch-search")){a._search();return false}a._popup(true);return false}).filter(":eq(1)").add(a.$popup).bind("keyup focusin",function(e){e.type=="focusin"&&a._popup(true);e.which==27&&a._popup(false)});var b,c=[];for(b in a.options.websearch)if(a.options.websearch[b][0]!==""){b==a.options.defaultSite&& a._setSearchSite(b);c.push('<a href="#" class="site" data-name="'+b+'"><span class="icon-websearch '+a.options.websearch[b][0]+'"></span>'+b+"</a>")}a.options.sortList&&c.sort();a.$popup.html(c.join(" ")||"No Search Engines Set").find(".site").click(function(){a._setSearchSite(d(this).attr("data-name"));a._popup(false);return false}).hover(function(){d(this).toggleClass("highlight")}).keyup(function(e){e.which==40&&d(this).next().focus();e.which==38&&d(this).prev().focus()});a.$el.keyup(function(e){e.which=== 13&&a._search()});a.$button.eq(1).addClass("last");a.options.hideSelector&&a.$button.addClass("last").eq(1).hide();a.popupWidth=a.$popup.width();a.popupHeight=a.$popup.outerHeight();a.buttonHeight=a.$wrap.outerHeight();a.options.hidden&&a.$wrap.hide()};a._popup=function(b){if(!(b&&a.$popup.is(":visible")||a.options.hideSelector))if(b){var c=a.$button.position();b=c.left+a.popupWidth<d(window).width()-50?c.left:d(window).width()-a.popupWidth-50;c=c.top-a.popupHeight<d(window).scrollTop()?c.top+a.buttonHeight: c.top-a.popupHeight;a.$popup.css({position:"absolute",left:b,top:c,width:a.popupWidth}).fadeIn("slow")}else a.$popup.fadeOut("slow")};a._setSearchSite=function(b){if(typeof b==="undefined"||b===""||!a.options.websearch.hasOwnProperty(b))return a.$button.attr("title");var c=a.options.websearch[b];a.$el.attr("data-search-string",c[1]||"").next().attr("title",b).find(".icon-websearch-search").attr("class","icon-websearch-search "+c[0]||"");a.$el.trigger("change",b);return b};a._search=function(b,c,e){b= escape(b||a.$el.val());var g=a.$el.attr("data-search-string").replace(/\{s\}/g,b);g===""||b===""||(a.options.searchResult?a.options.searchResult.call(a.$el,g):window.open(g,c||a.options.windowTarget,e||a.options.windowOptions))};a.current=function(b){return typeof b==="undefined"||b===""?a.$button.attr("title"):this._setSearchSite(b)};a.search=function(b,c,e){this._search(b,c,e)};a.init()};d.websearch.defaultOptions={defaultSite:"Google",windowTarget:"_blank",windowOptions:"",tooltipClass:"tooltip", hideSelector:false,sortList:true,hidden:false,searchResult:null,websearch:{Google:["ui-icon-google","http://www.google.com/search?q={s}"]}};d.fn.websearch=function(f){return this.each(function(){d(this).is(".websearch-input")||new d.websearch(this,f)})};d.fn.getwebsearch=function(){this.data("websearch")}})(jQuery);